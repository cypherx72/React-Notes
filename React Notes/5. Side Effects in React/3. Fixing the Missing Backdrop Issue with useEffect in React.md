
#### **âš ï¸ The Problem: Calling `showModal()` and `close()` Too Early**

When we try to show or close the modal directly inside the component function, we get an error. This happens because: Â 

âœ… The **dialog element (ref) is not yet assigned** when the component first renders. Â 
âœ… We're calling `showModal()` and `close()` **before the ref is set**. Â 

  
---

### **ðŸš€ The Solution: Using `useEffect`**

To make sure `showModal()` and `close()` are called **only after the ref is set**, we should use `useEffect`:


```jsx
import { useEffect, useRef } from "react";

function Modal({ open }) {
Â  const dialogRef = useRef(null);

Â  useEffect(() => {
Â  Â  if (!dialogRef.current) return; // Ensure ref is assigned
Â  Â  if (open) {
Â  Â  Â  dialogRef.current.showModal();
Â  Â  } else {
Â  Â  Â  dialogRef.current.close();
Â  Â  }
Â  }, [open]); // Run effect whenever `open` changes

Â  return <dialog ref={dialogRef}>I am a Modal</dialog>;
}
```

  
---

### **ðŸ”¥ How This Works**

1ï¸âƒ£ `useRef(null)` ensures `dialogRef` is persisted across renders. Â 

2ï¸âƒ£ `useEffect(() => { ... }, [open])` runs **only when `open` changes**. Â 

3ï¸âƒ£ We **check if `dialogRef.current` exists** before calling `showModal()` or `close()`. Â 

4ï¸âƒ£ The modal **only updates when `open` changes**, preventing unnecessary calls. Â 

---
### **ðŸŽ¯ Why This Works**

âœ… **Backdrop is shown properly** because `showModal()` is called inside `useEffect`. Â 
âœ… **No unnecessary re-renders** since `useEffect` only runs when `open` changes. Â 
âœ… **No `useImperativeHandle` needed**, making it a cleaner solution. Â 


---

### **ðŸ”¥ Bonus: Close Modal on Click Outside**

To close the modal when clicking outside, modify `Modal.js`:

```jsx
useEffect(() => {
Â  if (!dialogRef.current) return;
Â  const handleOutsideClick = (event) => {
Â  Â  if (event.target === dialogRef.current) {
Â  Â  Â  dialogRef.current.close();
Â  Â  }
Â  };

Â  dialogRef.current.addEventListener("click", handleOutsideClick);
Â  return () => dialogRef.current.removeEventListener("click", handleOutsideClick);
}, []);
```

Now clicking outside the modal will also close it! ðŸŽ‰ Â 

---
### **ðŸŽ¯ Key Takeaways**

âœ… **Avoid modifying DOM elements directly inside the component function**â€”use `useEffect` instead. Â 
âœ… **Check if `ref` exists** before calling methods on it. Â 
âœ… **Use dependency arrays** (`[open]`) to ensure effects run at the right time. Â 

  

