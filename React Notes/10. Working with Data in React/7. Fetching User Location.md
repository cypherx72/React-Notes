---

  

### ðŸš€ **Fetching User Location and Sorting Places** Â 

  

---

To fetch the user's location, use the browser's built-in `navigator.geolocation` API. Â 
### Key Steps: Â 

1. **Request Permission**: The browser will prompt the user for permission to access their location. Â 

2. **Use `getCurrentPosition`**: This method takes a callback function that receives the user's coordinates. Â 

### Example: Â 

```javascript
navigator.geolocation.getCurrentPosition((position) => {
Â  const { latitude, longitude } = position.coords;
Â  console.log(latitude, longitude); // User's coordinates
});
```

---

## ðŸ› ï¸ **Sorting Places by Distance** Â 

After fetching the user's location, sort the places by their distance from the user. Â 

### Key Steps: Â 

1. **Import Sorting Function**: Use a utility function (e.g., `sortPlacesByDistance`) to sort the places. Â 

2. **Pass Coordinates**: Provide the user's latitude and longitude to the sorting function. Â 

### Example: Â 

```javascript
import { sortPlacesByDistance } from './loc.js'; // Import sorting function

const sortedPlaces = sortPlacesByDistance(
Â  resData.places, // Array of places
Â  latitude, Â  Â  Â  // User's latitude
Â  longitude Â  Â  Â  // User's longitude
);

setAvailablePlaces(sortedPlaces); // Update state with sorted places
```


---

## ðŸ”„ **Handling Asynchronous Operations** Â 

Since `getCurrentPosition` uses a callback (not promises), you need to: Â 

1. **Move `setIsFetching(false)`**: Call it inside the callback to ensure it runs after sorting and setting the places. Â 

2. **Handle Errors**: Update the error state if fetching the location fails. Â 

### Example: Â 

```javascript
useEffect(() => {
Â  setIsFetching(true);
Â  async function fetchPlaces() {
Â  Â  try {
Â  Â  Â  const response = await fetch('http://localhost:3000/places');
Â  Â  Â  const resData = await response.json();

Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  throw new Error('Failed to fetch places');
Â  Â  Â  }
Â  Â  Â  // Fetch user location
Â  Â  navigator.geolocation.getCurrentPosition(
Â  Â  Â  Â  (position) => {
Â  Â  Â  Â  Â  const { latitude, longitude } = position.coords;
Â  Â  Â  Â  Â  const sortedPlaces = sortPlacesByDistance(resData.places, latitude, longitude);
Â  Â  Â  Â  Â  setAvailablePlaces(sortedPlaces); // Update state with sorted places
Â  Â  Â  Â  Â  setIsFetching(false); // End loading state
Â  Â  Â  Â  },
Â  Â  Â  Â  (error) => {
Â  Â  Â  Â  Â  setError({ message: 'Could not fetch location, please try again later.' });
Â  Â  Â  Â  Â  setIsFetching(false); // End loading state
Â  Â  Â  Â  }
Â  Â  Â  );
Â  Â  } catch (error) {
Â  Â  Â  setError({ message: error.message || 'Could not fetch places, please try again later.' });
Â  Â  Â  setIsFetching(false); // End loading state
Â  Â  }
Â  }

Â  fetchPlaces();
}, []);
```


---

## ðŸ”‘ **Key Takeaways** Â 

1. **Fetch User Location**: Use `navigator.geolocation.getCurrentPosition`. Â 

2. **Sort Places**: Use a utility function to sort places by distance. Â 

3. **Handle Asynchronous Operations**: Ensure `setIsFetching(false)` is called after all asynchronous tasks are complete. Â 

4. **Error Handling**: Handle errors for both fetching places and user location. Â 

---